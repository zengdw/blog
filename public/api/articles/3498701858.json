{"title":"logback同步日志到ELK","uid":"8aaa3a5ad3ad0ba7a4b24d73de49e176","slug":3498701858,"date":"2023-05-26T06:34:42.000Z","updated":"2024-11-07T06:45:23.580Z","comments":true,"path":"api/articles/3498701858.json","keywords":"zengdw, java, html, js, css, spring, mysql","cover":"/img/cover/11.jpg","content":"<h3 id=\"使用docker-compose搭建ELK服务\"><a href=\"#使用docker-compose搭建ELK服务\" class=\"headerlink\" title=\"使用docker-compose搭建ELK服务\"></a>使用docker-compose搭建ELK服务</h3><pre class=\"line-numbers language-yaml\" data-language=\"yaml\"><code class=\"language-yaml\">version: &quot;2&quot;\nservices:\n  es:\n    image: docker.elastic.co&#x2F;elasticsearch&#x2F;elasticsearch:7.17.10\n    container_name: &quot;es&quot;\n    environment:\n      - node.name&#x3D;es01\n      - cluster.name&#x3D;es-docker-cluster\n      # - discovery.seed_hosts&#x3D;es02,es03\n      # - cluster.initial_master_nodes&#x3D;es01,es02,es03\n      - bootstrap.memory_lock&#x3D;true\n      - &quot;ES_JAVA_OPTS&#x3D;-Xms512m -Xmx512m&quot;\n      - discovery.type&#x3D;single-node\n    volumes:\n      - .&#x2F;es&#x2F;data:&#x2F;usr&#x2F;share&#x2F;elasticsearch&#x2F;data\n      - .&#x2F;es&#x2F;plugins:&#x2F;usr&#x2F;share&#x2F;elasticsearch&#x2F;plugins\n    ports:\n      - &quot;9200:9200&quot;\n      - &quot;9300:9300&quot;\n    restart: always\n  kibana:\n    image: docker.elastic.co&#x2F;kibana&#x2F;kibana:7.17.10\n    container_name: &quot;kibana&quot;\n    restart: always\n    ports:\n      - &quot;5601:5601&quot;\n    environment:\n      - ELASTICSEARCH_HOSTS&#x3D;http:&#x2F;&#x2F;es:9200\n      - I18N_LOCALE&#x3D;zh-CN\n    # volumes:\n    #   - .&#x2F;kibana&#x2F;kibana.yml:&#x2F;usr&#x2F;share&#x2F;kibana&#x2F;config&#x2F;kibana.yml\n    depends_on:\n      - es\n  logstash:\n    image: docker.elastic.co&#x2F;logstash&#x2F;logstash:7.17.10\n    container_name: logstash\n    restart: always\n    environment:\n      - MONITORING_ELASTICSEARCH_HOSTS&#x3D;http:&#x2F;&#x2F;es:9200\n    volumes:\n      - .&#x2F;logstash&#x2F;pipeline&#x2F;:&#x2F;usr&#x2F;share&#x2F;logstash&#x2F;pipeline&#x2F;\n    ports:\n      - 4567:4567\n    depends_on:\n      - es\n</code></pre>\n\n<h3 id=\"添加logstash管道配置\"><a href=\"#添加logstash管道配置\" class=\"headerlink\" title=\"添加logstash管道配置\"></a>添加logstash管道配置</h3><pre class=\"line-numbers language-none\"><code class=\"language-none\">input &#123;\n  tcp &#123; &#x2F;&#x2F; 启动tcp服务，监听4567端口，接收logback发送的日志信息\n    mode &#x3D;&gt; &quot;server&quot;\n    host &#x3D;&gt; &quot;0.0.0.0&quot;\n    port &#x3D;&gt; 4567\n    codec &#x3D;&gt; json_lines\n  &#125;\n&#125;\n\nfilter &#123;\n  json &#123;\n    source &#x3D;&gt; &quot;message&quot;\n  &#125;\n&#125;\n\noutput &#123;\n  elasticsearch &#123;\n    hosts &#x3D;&gt; [&quot;http:&#x2F;&#x2F;es:9200&quot;]\n    index &#x3D;&gt; &quot;%&#123;[appname]&#125;-%&#123;+YYYY.MM.dd&#125;&quot;\n    action &#x3D;&gt; &quot;create&quot;\n    #user &#x3D;&gt; &quot;elastic&quot;\n    #password &#x3D;&gt; &quot;changeme&quot;\n  &#125;\n&#125;\n</code></pre>\n\n<h3 id=\"springboot配置\"><a href=\"#springboot配置\" class=\"headerlink\" title=\"springboot配置\"></a>springboot配置</h3><p><strong>pom.xml</strong>文件</p>\n<pre class=\"line-numbers language-xml\" data-language=\"xml\"><code class=\"language-xml\">&lt;dependency&gt;\n    &lt;groupId&gt;net.logstash.logback&lt;&#x2F;groupId&gt;\n    &lt;artifactId&gt;logstash-logback-encoder&lt;&#x2F;artifactId&gt;\n    &lt;version&gt;7.3&lt;&#x2F;version&gt;\n&lt;&#x2F;dependency&gt;</code></pre>\n\n<p><strong>logback-spring.xml</strong>配置</p>\n<pre class=\"line-numbers language-xml\" data-language=\"xml\"><code class=\"language-xml\">&lt;!-- 输出到logstash --&gt;\n&lt;appender name&#x3D;&quot;logstash&quot; class&#x3D;&quot;net.logstash.logback.appender.LogstashTcpSocketAppender&quot;&gt;\n    &lt;!-- 上面logstash管道配置的端口 --&gt;\n    &lt;destination&gt;127.0.0.1:4567&lt;&#x2F;destination&gt;\n    &lt;encoder class&#x3D;&quot;net.logstash.logback.encoder.LogstashEncoder&quot;&gt;\n        &lt;!-- 添加自定义字段 json格式 --&gt;\n        &lt;customFields&gt;&#123;&quot;appname&quot;: &quot;1110-server&quot;&#125;&lt;&#x2F;customFields&gt;\n        &lt;!-- 包含代码中通过MDC添加的字段 --&gt;\n        &lt;includeMdc&gt;true&lt;&#x2F;includeMdc&gt;\n        &lt;includeCallerData&gt;true&lt;&#x2F;includeCallerData&gt;\n    &lt;&#x2F;encoder&gt;\n&lt;&#x2F;appender&gt;</code></pre>\n","feature":true,"text":"使用docker-compose搭建ELK服务version: &quot;2&quot; services: es: image: docker.elastic.co&#x2F;elasticsearch&#x2F;elasticsearch:7.17.10 container...","link":"","photos":[],"count_time":{"symbolsCount":"3.2k","symbolsTime":"3 mins."},"categories":[{"name":"ELK","slug":"ELK","count":1,"path":"api/categories/ELK.json"}],"tags":[{"name":"ELK","slug":"ELK","count":1,"path":"api/tags/ELK.json"},{"name":"logback","slug":"logback","count":2,"path":"api/tags/logback.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E4%BD%BF%E7%94%A8docker-compose%E6%90%AD%E5%BB%BAELK%E6%9C%8D%E5%8A%A1\"><span class=\"toc-text\">使用docker-compose搭建ELK服务</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%B7%BB%E5%8A%A0logstash%E7%AE%A1%E9%81%93%E9%85%8D%E7%BD%AE\"><span class=\"toc-text\">添加logstash管道配置</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#springboot%E9%85%8D%E7%BD%AE\"><span class=\"toc-text\">springboot配置</span></a></li></ol>","author":{"name":"zengdw","slug":"blog-author","avatar":"/img/z.png","link":"/","description":"个人学习记录","socials":{"github":"https://github.com/zengdw","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{"gitee":{"icon":"/img/svg/gitee.svg","link":"https://gitee.com/zengdw"},"email":{"icon":"/img/svg/email-fill.svg","link":"mailto:309606298@qq.com"}}}},"mapped":true,"prev_post":{},"next_post":{"title":"Centos 7 安装 rabbitmq","uid":"35fc538bb1078fab2885b8644c7b9dfc","slug":2535833376,"date":"2022-08-25T07:13:01.000Z","updated":"2024-11-07T06:45:23.575Z","comments":true,"path":"api/articles/2535833376.json","keywords":"zengdw, java, html, js, css, spring, mysql","cover":"/img/cover/8.jpg","text":"Centos 7 安装 rabbitmqrabbitmq最新版本已不支持Centos 7 创建仓库 # In &#x2F;etc&#x2F;yum.repos.d&#x2F;rabbitmq.repo ## ## Zero dependency Erlang ## [rabbit...","link":"","photos":[],"count_time":{"symbolsCount":"3k","symbolsTime":"3 mins."},"categories":[{"name":"rabbitmq","slug":"rabbitmq","count":1,"path":"api/categories/rabbitmq.json"},{"name":"linux","slug":"rabbitmq/linux","count":1,"path":"api/categories/rabbitmq/linux.json"}],"tags":[{"name":"centos","slug":"centos","count":1,"path":"api/tags/centos.json"},{"name":"rabbitmq","slug":"rabbitmq","count":1,"path":"api/tags/rabbitmq.json"}],"author":{"name":"zengdw","slug":"blog-author","avatar":"/img/z.png","link":"/","description":"个人学习记录","socials":{"github":"https://github.com/zengdw","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{"gitee":{"icon":"/img/svg/gitee.svg","link":"https://gitee.com/zengdw"},"email":{"icon":"/img/svg/email-fill.svg","link":"mailto:309606298@qq.com"}}}},"feature":true}}