{"title":"获取用户的真实IP","uid":"3a20f9ead7abf255a8999dd2c6eebc60","slug":6899,"date":"2020-10-13T02:29:30.000Z","updated":"2024-11-07T06:45:23.587Z","comments":true,"path":"api/articles/6899.json","keywords":"zengdw, java, html, js, css, spring, mysql","cover":null,"content":"<pre class=\"line-numbers language-java\" data-language=\"java\"><code class=\"language-java\">&#x2F;**\n * 获取用户的真实ip\n * @Date: 2020&#x2F;10&#x2F;12 17:31\n * @Version: 1.0\n *&#x2F;\npublic class IpUtils &#123;\n    public static String getRealIp(HttpServletRequest request) &#123;\n        String ipAddress &#x3D; request.getHeader(&quot;x-forwarded-for&quot;);\n        if(ipAddress &#x3D;&#x3D; null || ipAddress.length() &#x3D;&#x3D;0 || &quot;unknown&quot;.equals(ipAddress))&#123;\n            ipAddress &#x3D; request.getHeader(&quot;Proxy-Client-IP&quot;);\n        &#125;\n        if (ipAddress &#x3D;&#x3D; null || ipAddress.length() &#x3D;&#x3D; 0 || &quot;unknown&quot;.equalsIgnoreCase(ipAddress)) &#123;\n            ipAddress &#x3D; request.getHeader(&quot;Proxy-Client-IP&quot;);\n        &#125;\n        if(ipAddress &#x3D;&#x3D; null || ipAddress.length() &#x3D;&#x3D; 0 || &quot;unknown&quot;.equalsIgnoreCase(ipAddress)) &#123;\n            ipAddress &#x3D; request.getHeader(&quot;WL-Proxy-Client-IP&quot;);\n        &#125;\n        if (StringUtils.isEmpty(ipAddress) || &quot;unknown&quot;.equalsIgnoreCase(ipAddress)) &#123;\n            ipAddress &#x3D; request.getHeader(&quot;HTTP_CLIENT_IP&quot;);\n        &#125;\n        if (StringUtils.isEmpty(ipAddress) || &quot;unknown&quot;.equalsIgnoreCase(ipAddress)) &#123;\n            ipAddress &#x3D; request.getHeader(&quot;HTTP_X_FORWARDED_FOR&quot;);\n        &#125;\n        if (ipAddress &#x3D;&#x3D; null || ipAddress.length() &#x3D;&#x3D; 0 || &quot;unknown&quot;.equalsIgnoreCase(ipAddress)) &#123;\n            ipAddress &#x3D; request.getHeader(&quot;X-Real-IP&quot;);\n        &#125;\n        if(ipAddress &#x3D;&#x3D; null || ipAddress.length() &#x3D;&#x3D; 0 || &quot;unknown&quot;.equalsIgnoreCase(ipAddress)) &#123;\n            ipAddress &#x3D; request.getRemoteAddr();\n            if(&quot;127.0.0.1&quot;.equals(ipAddress) || &quot;0:0:0:0:0:0:0:1&quot;.equals(ipAddress))&#123;\n                &#x2F;&#x2F;根据网卡取本机配置的IP\n                InetAddress inet&#x3D;null;\n                try &#123;\n                    inet &#x3D; InetAddress.getLocalHost();\n                &#125; catch (UnknownHostException e) &#123;\n                    e.printStackTrace();\n                &#125;\n                ipAddress&#x3D; inet.getHostAddress();\n            &#125;\n        &#125;\n        &#x2F;&#x2F;对于通过多个代理的情况，第一个IP为客户端真实IP,多个IP按照&#39;,&#39;分割\n        &#x2F;&#x2F;&quot;***.***.***.***&quot;.length() &#x3D; 15\n        if(ipAddress!&#x3D;null &amp;&amp; ipAddress.length()&gt;15)&#123;\n            if(ipAddress.indexOf(&quot;,&quot;)&gt;0)&#123;\n                ipAddress &#x3D; ipAddress.substring(0,ipAddress.indexOf(&quot;,&quot;));\n            &#125;\n        &#125;\n        return ipAddress;\n    &#125;\n&#125;</code></pre>\n\n","text":"&#x2F;** * 获取用户的真实ip * @Date: 2020&#x2F;10&#x2F;12 17:31 * @Version: 1.0 *&#x2F; public class IpUtils &#123; public static String getRealIp(...","link":"","photos":[],"count_time":{"symbolsCount":"2.7k","symbolsTime":"2 mins."},"categories":[{"name":"常用工具类","slug":"常用工具类","count":1,"path":"api/categories/常用工具类.json"}],"tags":[{"name":"ip","slug":"ip","count":1,"path":"api/tags/ip.json"}],"toc":"","author":{"name":"zengdw","slug":"blog-author","avatar":"/img/z.png","link":"/","description":"个人学习记录","socials":{"github":"https://github.com/zengdw","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{"gitee":{"icon":"/img/svg/gitee.svg","link":"https://gitee.com/zengdw"},"email":{"icon":"/img/svg/email-fill.svg","link":"mailto:309606298@qq.com"}}}},"mapped":true,"prev_post":{"title":"oauth2获取token的4种模式","uid":"08a5a1672aa09760d3d6299b9461747e","slug":33303,"date":"2020-11-05T06:01:54.000Z","updated":"2024-11-07T06:45:23.581Z","comments":true,"path":"api/articles/33303.json","keywords":"zengdw, java, html, js, css, spring, mysql","cover":null,"text":"1、授权码模式（authorization_code）1.1 获取code/oauth/authorize?client_id=client1&amp;redirect_uri=https://www.baidu.com/&amp;response_type=code 1.2 获...","link":"","photos":[],"count_time":{"symbolsCount":765,"symbolsTime":"1 mins."},"categories":[{"name":"java","slug":"java","count":4,"path":"api/categories/java.json"}],"tags":[{"name":"spring","slug":"spring","count":2,"path":"api/tags/spring.json"},{"name":"oauth2","slug":"oauth2","count":2,"path":"api/tags/oauth2.json"}],"author":{"name":"zengdw","slug":"blog-author","avatar":"/img/z.png","link":"/","description":"个人学习记录","socials":{"github":"https://github.com/zengdw","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{"gitee":{"icon":"/img/svg/gitee.svg","link":"https://gitee.com/zengdw"},"email":{"icon":"/img/svg/email-fill.svg","link":"mailto:309606298@qq.com"}}}}},"next_post":{"title":"修改powerDesigner生成mysql关键字默认双引号问题","uid":"34ee5f9776190da84e997dce1e66c72e","slug":58587,"date":"2020-09-23T02:47:48.000Z","updated":"2024-11-13T02:24:55.918Z","comments":true,"path":"api/articles/58587.json","keywords":"zengdw, java, html, js, css, spring, mysql","cover":[],"text":"在powerDesigner中设计完数据表后，执行generate database时生成的sql中如果有表的字段是关键字时可能会出现双引号的问题。 只需修改下面这个地方，在生成sql时就是替换为反引号 ","link":"","photos":[],"count_time":{"symbolsCount":104,"symbolsTime":"1 mins."},"categories":[{"name":"软件工具","slug":"软件工具","count":5,"path":"api/categories/软件工具.json"}],"tags":[{"name":"powerDesigner","slug":"powerDesigner","count":1,"path":"api/tags/powerDesigner.json"},{"name":"mysql","slug":"mysql","count":1,"path":"api/tags/mysql.json"}],"author":{"name":"zengdw","slug":"blog-author","avatar":"/img/z.png","link":"/","description":"个人学习记录","socials":{"github":"https://github.com/zengdw","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{"gitee":{"icon":"/img/svg/gitee.svg","link":"https://gitee.com/zengdw"},"email":{"icon":"/img/svg/email-fill.svg","link":"mailto:309606298@qq.com"}}}}}}